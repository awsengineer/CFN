{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Metadata": {
    "AWS::CloudFormation::Designer": {
      "f6ffaafc-16fb-4adf-882b-9f88015f51b7": {
        "size": {
          "width": 360,
          "height": 90
        },
        "position": {
          "x": 6280,
          "y": 1870
        },
        "z": 1,
        "embeds": [
          "745fc5cd-8b2f-4df0-9cf6-e3c2d882170b",
          "acd2d8c4-cac7-4595-a154-2ebccf543383",
          "b6a4b96a-b79b-4e57-8b5b-f0ae752d83c0",
          "3674c3c0-b5c9-49ba-b8e5-5103fcddb78d",
          "dbe5c584-7b5f-485c-a10b-9d55bcab415f",
          "f9abaa80-8d82-4ba3-8907-955e296bc4eb"
        ]
      },
      "62296718-6807-467b-99a9-38200ddb8319": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 6710,
          "y": 1880
        },
        "z": 0,
        "embeds": []
      },
      "804b9ca0-a56e-41b0-b501-c0a53d2f525f": {
        "source": {
          "id": "62296718-6807-467b-99a9-38200ddb8319"
        },
        "target": {
          "id": "f6ffaafc-16fb-4adf-882b-9f88015f51b7"
        },
        "z": 0
      },
      "f9abaa80-8d82-4ba3-8907-955e296bc4eb": {
        "size": {
          "width": 90,
          "height": 30
        },
        "position": {
          "x": 6550,
          "y": 1750
        },
        "z": 0,
        "parent": "f6ffaafc-16fb-4adf-882b-9f88015f51b7",
        "embeds": []
      },
      "af638fc3-3398-47c6-8e86-5b7dec4662ba": {
        "source": {
          "id": "f9abaa80-8d82-4ba3-8907-955e296bc4eb"
        },
        "target": {
          "id": "f6ffaafc-16fb-4adf-882b-9f88015f51b7"
        },
        "z": 1
      },
      "dbe5c584-7b5f-485c-a10b-9d55bcab415f": {
        "size": {
          "width": 90,
          "height": 30
        },
        "position": {
          "x": 6550,
          "y": 1820
        },
        "z": 0,
        "parent": "f6ffaafc-16fb-4adf-882b-9f88015f51b7",
        "embeds": []
      },
      "832a5185-7831-44af-abb0-1d3998415b9e": {
        "source": {
          "id": "9a076a69-7949-49c1-a19c-d1af72c159fc"
        },
        "target": {
          "id": "f6ffaafc-16fb-4adf-882b-9f88015f51b7"
        },
        "z": 2
      },
      "69b38e7c-eeb6-426b-8dc4-a1a66e118d7f": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 720,
          "y": 50
        },
        "z": 0,
        "embeds": [],
        "ismemberof": [
          "9a076a69-7949-49c1-a19c-d1af72c159fc"
        ]
      },
      "cd68fcef-de41-4cb3-8d1a-191ed8c6a32d": {
        "source": {
          "id": "69b38e7c-eeb6-426b-8dc4-a1a66e118d7f"
        },
        "target": {
          "id": "9a076a69-7949-49c1-a19c-d1af72c159fc"
        },
        "z": 2
      },
      "3674c3c0-b5c9-49ba-b8e5-5103fcddb78d": {
        "size": {
          "width": 100,
          "height": 40
        },
        "position": {
          "x": 6730,
          "y": 1730
        },
        "z": 0,
        "parent": "f6ffaafc-16fb-4adf-882b-9f88015f51b7",
        "embeds": []
      },
      "9928691f-7c5b-4f40-b8a4-751713dc6bfa": {
        "source": {
          "id": "3674c3c0-b5c9-49ba-b8e5-5103fcddb78d"
        },
        "target": {
          "id": "dbe5c584-7b5f-485c-a10b-9d55bcab415f"
        },
        "z": 0
      },
      "d9b9492d-a33f-4566-a22d-569a35fe58c0": {
        "source": {
          "id": "3674c3c0-b5c9-49ba-b8e5-5103fcddb78d"
        },
        "target": {
          "id": "f9abaa80-8d82-4ba3-8907-955e296bc4eb"
        },
        "z": 0
      },
      "2f10149c-07c0-41b2-ae93-7d49b164e827": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 6830,
          "y": 1880
        },
        "z": 0,
        "embeds": [],
        "references": [
          "62296718-6807-467b-99a9-38200ddb8319"
        ],
        "dependson": [
          "804b9ca0-a56e-41b0-b501-c0a53d2f525f"
        ]
      },
      "3038c30a-eb1d-4dd1-a44e-0a1ec7c34f79": {
        "source": {
          "id": "2f10149c-07c0-41b2-ae93-7d49b164e827"
        },
        "target": {
          "id": "62296718-6807-467b-99a9-38200ddb8319"
        },
        "z": 2
      },
      "7d8dbf07-d96e-4a0a-bf73-8e7ee445ed2e": {
        "source": {
          "id": "7ffa7a86-d8ad-4fc7-b7e5-8937df83be08"
        },
        "target": {
          "id": "f9abaa80-8d82-4ba3-8907-955e296bc4eb"
        },
        "z": 11
      },
      "13308b98-d238-4de9-9bd3-d9f0e99d0843": {
        "source": {
          "id": "7ffa7a86-d8ad-4fc7-b7e5-8937df83be08"
        },
        "target": {
          "id": "dbe5c584-7b5f-485c-a10b-9d55bcab415f"
        },
        "z": 12
      },
      "83e04eef-6526-4aa1-904c-6e040b8d4b7b": {
        "source": {
          "id": "7ffa7a86-d8ad-4fc7-b7e5-8937df83be08"
        },
        "target": {
          "id": "62296718-6807-467b-99a9-38200ddb8319"
        },
        "z": 11
      },
      "c4f712a2-5ad8-444a-af2d-e844a0a0d21d": {
        "source": {
          "id": "7ffa7a86-d8ad-4fc7-b7e5-8937df83be08"
        },
        "target": {
          "id": "f02db624-8917-40f8-9023-6a80d6836a07"
        },
        "z": 11
      },
      "b3529ba7-a16a-435d-a3f1-40d04449a51a": {
        "source": {
          "id": "7ffa7a86-d8ad-4fc7-b7e5-8937df83be08",
          "selector": "g:nth-child(1) g:nth-child(4) g:nth-child(4) circle:nth-child(1)     ",
          "port": "AWS::DependencyLink-*"
        },
        "target": {
          "id": "f02db624-8917-40f8-9023-6a80d6836a07"
        },
        "z": 12
      },
      "e853c9a6-c65b-4e78-97f9-f557b632c6dc": {
        "source": {
          "id": "7ffa7a86-d8ad-4fc7-b7e5-8937df83be08"
        },
        "target": {
          "id": "f02db624-8917-40f8-9023-6a80d6836a07"
        },
        "z": 11
      },
      "a20dcf34-6b53-4abd-9a37-d18547cc7467": {
        "source": {
          "id": "2120777a-af9e-4b07-9a0b-b8393c308e21"
        },
        "target": {
          "id": "7ffa7a86-d8ad-4fc7-b7e5-8937df83be08"
        },
        "z": 11
      },
      "8839cc3d-bcab-43e4-8544-77d8475b3454": {
        "source": {
          "id": "9a076a69-7949-49c1-a19c-d1af72c159fc"
        },
        "target": {
          "id": "f02db624-8917-40f8-9023-6a80d6836a07"
        },
        "z": 11
      },
      "b6a4b96a-b79b-4e57-8b5b-f0ae752d83c0": {
        "size": {
          "width": 100,
          "height": 30
        },
        "position": {
          "x": 6280,
          "y": 1750
        },
        "z": 0,
        "parent": "f6ffaafc-16fb-4adf-882b-9f88015f51b7",
        "embeds": []
      },
      "acd2d8c4-cac7-4595-a154-2ebccf543383": {
        "size": {
          "width": 100,
          "height": 30
        },
        "position": {
          "x": 6280,
          "y": 1820
        },
        "z": 0,
        "parent": "f6ffaafc-16fb-4adf-882b-9f88015f51b7",
        "embeds": []
      },
      "b1104c7b-7b52-46be-b39b-be453e2ea945": {
        "size": {
          "width": 90,
          "height": 40
        },
        "position": {
          "x": 6130,
          "y": 1750
        },
        "z": 0,
        "embeds": [
          "bc1c8512-adf9-4791-b85f-2ee3ca5cab21"
        ]
      },
      "29081c4e-62be-4fd7-9e10-f89d96e59ccb": {
        "source": {
          "id": "2120777a-af9e-4b07-9a0b-b8393c308e21"
        },
        "target": {
          "id": "7ffa7a86-d8ad-4fc7-b7e5-8937df83be08"
        },
        "z": 11
      },
      "a8ced0dd-aa63-4d50-83f2-2af68ae45e0a": {
        "source": {
          "id": "dea0c8de-d55d-4adb-a061-523335f02529"
        },
        "target": {
          "id": "81026f96-a90a-499e-bcd9-0190438f8388"
        },
        "z": 11
      },
      "c23f1a85-2d2b-478e-9437-f9dfe7ae62b2": {
        "source": {
          "id": "f6444669-fd72-4dd6-b7a7-a251a74caf28"
        },
        "target": {
          "id": "bc1c8512-adf9-4791-b85f-2ee3ca5cab21"
        },
        "z": 11
      },
      "56f4a522-4ee1-426f-9a7c-5a5a710e45a7": {
        "source": {
          "id": "4100791a-5fb9-4c5e-8107-f7a8f39e6eb0"
        },
        "target": {
          "id": "2379c93f-3dcf-420a-b465-c6f45c01e745"
        },
        "z": 11
      },
      "745fc5cd-8b2f-4df0-9cf6-e3c2d882170b": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 6310,
          "y": 1610
        },
        "z": 0,
        "parent": "f6ffaafc-16fb-4adf-882b-9f88015f51b7",
        "embeds": []
      },
      "9fcae438-e844-40e7-9bc5-4e5d21bb4340": {
        "source": {
          "id": "28dc68b4-895f-4ed4-b15e-be4cbc8e06b5"
        },
        "target": {
          "id": "745fc5cd-8b2f-4df0-9cf6-e3c2d882170b"
        },
        "z": 11
      },
      "b37b7ee5-e44d-4101-826d-893b11cdbf33": {
        "source": {
          "id": "28dc68b4-895f-4ed4-b15e-be4cbc8e06b5"
        },
        "target": {
          "id": "81b2bf9d-82c3-4b74-88eb-e4ebb8696d4a"
        },
        "z": 11
      },
      "9f0e24ac-b06e-4df2-a505-3c6d1c088b36": {
        "source": {
          "id": "81b2bf9d-82c3-4b74-88eb-e4ebb8696d4a"
        },
        "target": {
          "id": "745fc5cd-8b2f-4df0-9cf6-e3c2d882170b"
        },
        "z": 12
      },
      "168d7868-7dc3-4e01-95ed-111719c882f3": {
        "source": {
          "id": "28dc68b4-895f-4ed4-b15e-be4cbc8e06b5"
        },
        "target": {
          "id": "81b2bf9d-82c3-4b74-88eb-e4ebb8696d4a"
        },
        "z": 11
      },
      "f9c94ba6-2b9f-44d7-aa68-58381f194463": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 6540,
          "y": 1610
        },
        "z": 0,
        "embeds": [],
        "isconnectedto": [
          "dbe5c584-7b5f-485c-a10b-9d55bcab415f",
          "f9abaa80-8d82-4ba3-8907-955e296bc4eb"
        ],
        "isassociatedwith": [
          "31e67e42-15ec-40fb-8ed8-9b3904d3ed07"
        ]
      },
      "31e67e42-15ec-40fb-8ed8-9b3904d3ed07": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 6420,
          "y": 1610
        },
        "z": 0,
        "embeds": [],
        "ismemberof": [
          "745fc5cd-8b2f-4df0-9cf6-e3c2d882170b"
        ]
      },
      "d85a5a15-d971-4e66-8534-8a9bf800c967": {
        "source": {
          "id": "31e67e42-15ec-40fb-8ed8-9b3904d3ed07"
        },
        "target": {
          "id": "745fc5cd-8b2f-4df0-9cf6-e3c2d882170b"
        },
        "z": 11
      },
      "8a9bf282-ec1e-46ce-813a-5fca5ebd384e": {
        "source": {
          "id": "f9c94ba6-2b9f-44d7-aa68-58381f194463"
        },
        "target": {
          "id": "31e67e42-15ec-40fb-8ed8-9b3904d3ed07"
        },
        "z": 11
      },
      "e3442544-076c-47fc-90c4-aa110606b523": {
        "source": {
          "id": "a0a254d4-113e-409e-a03c-3b80bf562261"
        },
        "target": {
          "id": "bfd231ac-a8fd-4c6c-bb76-a56639551823"
        },
        "z": 11
      },
      "7d62cb4e-97fd-4b89-a00a-8920c926c67c": {
        "size": {
          "width": 60,
          "height": 60
        },
        "position": {
          "x": 6420,
          "y": 1700
        },
        "z": 0,
        "embeds": []
      }
    }
  },
  "Mappings": {
    "AWSInstanceType2Arch": {
      "t1.micro": {
        "Arch": "PV64"
      },
      "t2.nano": {
        "Arch": "HVM64"
      },
      "t2.micro": {
        "Arch": "HVM64"
      },
      "t2.small": {
        "Arch": "HVM64"
      },
      "t2.medium": {
        "Arch": "HVM64"
      },
      "t2.large": {
        "Arch": "HVM64"
      },
      "m1.small": {
        "Arch": "PV64"
      },
      "m1.medium": {
        "Arch": "PV64"
      },
      "m1.large": {
        "Arch": "PV64"
      },
      "m1.xlarge": {
        "Arch": "PV64"
      },
      "m2.xlarge": {
        "Arch": "PV64"
      },
      "m2.2xlarge": {
        "Arch": "PV64"
      },
      "m2.4xlarge": {
        "Arch": "PV64"
      },
      "m3.medium": {
        "Arch": "HVM64"
      },
      "m3.large": {
        "Arch": "HVM64"
      },
      "m3.xlarge": {
        "Arch": "HVM64"
      },
      "m3.2xlarge": {
        "Arch": "HVM64"
      },
      "m4.large": {
        "Arch": "HVM64"
      },
      "m4.xlarge": {
        "Arch": "HVM64"
      },
      "m4.2xlarge": {
        "Arch": "HVM64"
      },
      "m4.4xlarge": {
        "Arch": "HVM64"
      },
      "m4.10xlarge": {
        "Arch": "HVM64"
      },
      "c1.medium": {
        "Arch": "PV64"
      },
      "c1.xlarge": {
        "Arch": "PV64"
      },
      "c3.large": {
        "Arch": "HVM64"
      },
      "c3.xlarge": {
        "Arch": "HVM64"
      },
      "c3.2xlarge": {
        "Arch": "HVM64"
      },
      "c3.4xlarge": {
        "Arch": "HVM64"
      },
      "c3.8xlarge": {
        "Arch": "HVM64"
      },
      "c4.large": {
        "Arch": "HVM64"
      },
      "c4.xlarge": {
        "Arch": "HVM64"
      },
      "c4.2xlarge": {
        "Arch": "HVM64"
      },
      "c4.4xlarge": {
        "Arch": "HVM64"
      },
      "c4.8xlarge": {
        "Arch": "HVM64"
      },
      "g2.2xlarge": {
        "Arch": "HVMG2"
      },
      "g2.8xlarge": {
        "Arch": "HVMG2"
      },
      "r3.large": {
        "Arch": "HVM64"
      },
      "r3.xlarge": {
        "Arch": "HVM64"
      },
      "r3.2xlarge": {
        "Arch": "HVM64"
      },
      "r3.4xlarge": {
        "Arch": "HVM64"
      },
      "r3.8xlarge": {
        "Arch": "HVM64"
      },
      "i2.xlarge": {
        "Arch": "HVM64"
      },
      "i2.2xlarge": {
        "Arch": "HVM64"
      },
      "i2.4xlarge": {
        "Arch": "HVM64"
      },
      "i2.8xlarge": {
        "Arch": "HVM64"
      },
      "d2.xlarge": {
        "Arch": "HVM64"
      },
      "d2.2xlarge": {
        "Arch": "HVM64"
      },
      "d2.4xlarge": {
        "Arch": "HVM64"
      },
      "d2.8xlarge": {
        "Arch": "HVM64"
      },
      "hi1.4xlarge": {
        "Arch": "HVM64"
      },
      "hs1.8xlarge": {
        "Arch": "HVM64"
      },
      "cr1.8xlarge": {
        "Arch": "HVM64"
      },
      "cc2.8xlarge": {
        "Arch": "HVM64"
      }
    },
    "AWSInstanceType2NATArch": {
      "t1.micro": {
        "Arch": "NATPV64"
      },
      "t2.nano": {
        "Arch": "NATHVM64"
      },
      "t2.micro": {
        "Arch": "NATHVM64"
      },
      "t2.small": {
        "Arch": "NATHVM64"
      },
      "t2.medium": {
        "Arch": "NATHVM64"
      },
      "t2.large": {
        "Arch": "NATHVM64"
      },
      "m1.small": {
        "Arch": "NATPV64"
      },
      "m1.medium": {
        "Arch": "NATPV64"
      },
      "m1.large": {
        "Arch": "NATPV64"
      },
      "m1.xlarge": {
        "Arch": "NATPV64"
      },
      "m2.xlarge": {
        "Arch": "NATPV64"
      },
      "m2.2xlarge": {
        "Arch": "NATPV64"
      },
      "m2.4xlarge": {
        "Arch": "NATPV64"
      },
      "m3.medium": {
        "Arch": "NATHVM64"
      },
      "m3.large": {
        "Arch": "NATHVM64"
      },
      "m3.xlarge": {
        "Arch": "NATHVM64"
      },
      "m3.2xlarge": {
        "Arch": "NATHVM64"
      },
      "m4.large": {
        "Arch": "NATHVM64"
      },
      "m4.xlarge": {
        "Arch": "NATHVM64"
      },
      "m4.2xlarge": {
        "Arch": "NATHVM64"
      },
      "m4.4xlarge": {
        "Arch": "NATHVM64"
      },
      "m4.10xlarge": {
        "Arch": "NATHVM64"
      },
      "c1.medium": {
        "Arch": "NATPV64"
      },
      "c1.xlarge": {
        "Arch": "NATPV64"
      },
      "c3.large": {
        "Arch": "NATHVM64"
      },
      "c3.xlarge": {
        "Arch": "NATHVM64"
      },
      "c3.2xlarge": {
        "Arch": "NATHVM64"
      },
      "c3.4xlarge": {
        "Arch": "NATHVM64"
      },
      "c3.8xlarge": {
        "Arch": "NATHVM64"
      },
      "c4.large": {
        "Arch": "NATHVM64"
      },
      "c4.xlarge": {
        "Arch": "NATHVM64"
      },
      "c4.2xlarge": {
        "Arch": "NATHVM64"
      },
      "c4.4xlarge": {
        "Arch": "NATHVM64"
      },
      "c4.8xlarge": {
        "Arch": "NATHVM64"
      },
      "g2.2xlarge": {
        "Arch": "NATHVMG2"
      },
      "g2.8xlarge": {
        "Arch": "NATHVMG2"
      },
      "r3.large": {
        "Arch": "NATHVM64"
      },
      "r3.xlarge": {
        "Arch": "NATHVM64"
      },
      "r3.2xlarge": {
        "Arch": "NATHVM64"
      },
      "r3.4xlarge": {
        "Arch": "NATHVM64"
      },
      "r3.8xlarge": {
        "Arch": "NATHVM64"
      },
      "i2.xlarge": {
        "Arch": "NATHVM64"
      },
      "i2.2xlarge": {
        "Arch": "NATHVM64"
      },
      "i2.4xlarge": {
        "Arch": "NATHVM64"
      },
      "i2.8xlarge": {
        "Arch": "NATHVM64"
      },
      "d2.xlarge": {
        "Arch": "NATHVM64"
      },
      "d2.2xlarge": {
        "Arch": "NATHVM64"
      },
      "d2.4xlarge": {
        "Arch": "NATHVM64"
      },
      "d2.8xlarge": {
        "Arch": "NATHVM64"
      },
      "hi1.4xlarge": {
        "Arch": "NATHVM64"
      },
      "hs1.8xlarge": {
        "Arch": "NATHVM64"
      },
      "cr1.8xlarge": {
        "Arch": "NATHVM64"
      },
      "cc2.8xlarge": {
        "Arch": "NATHVM64"
      }
    },
    "AWSRegionArch2AMI": {
      "us-east-1": {
        "PV64": "ami-22111148",
        "HVM64": "ami-08111162",
        "HVMG2": "ami-ebcec381"
      },
      "us-west-2": {
        "PV64": "ami-792bc219",
        "HVM64": "ami-c229c0a2",
        "HVMG2": "ami-0f28c06f"
      },
      "us-west-1": {
        "PV64": "ami-0e087a6e",
        "HVM64": "ami-1b0f7d7b",
        "HVMG2": "ami-ab9defcb"
      },
      "eu-west-1": {
        "PV64": "ami-a5368cd6",
        "HVM64": "ami-31328842",
        "HVMG2": "ami-d1d652a2"
      },
      "eu-central-1": {
        "PV64": "ami-2bde3944",
        "HVM64": "ami-e2df388d",
        "HVMG2": "ami-5240a73d"
      },
      "ap-northeast-1": {
        "PV64": "ami-37020959",
        "HVM64": "ami-f80e0596",
        "HVMG2": "ami-34a9a35a"
      },
      "ap-northeast-2": {
        "PV64": "NOT_SUPPORTED",
        "HVM64": "ami-6598510b",
        "HVMG2": "NOT_SUPPORTED"
      },
      "ap-southeast-1": {
        "PV64": "ami-ff0cc79c",
        "HVM64": "ami-e90dc68a",
        "HVMG2": "ami-6f6ca70c"
      },
      "ap-southeast-2": {
        "PV64": "ami-f5210196",
        "HVM64": "ami-f2210191",
        "HVMG2": "ami-88c1e1eb"
      },
      "sa-east-1": {
        "PV64": "ami-661e930a",
        "HVM64": "ami-1e159872",
        "HVMG2": "NOT_SUPPORTED"
      },
      "cn-north-1": {
        "PV64": "ami-08ef2465",
        "HVM64": "ami-49e22924",
        "HVMG2": "NOT_SUPPORTED"
      }
    }
  },
  "Parameters": {
    "InstanceType": {
      "Description": "WebServer EC2 instance type",
      "Type": "String",
      "Default": "t2.micro",
      "AllowedValues": [
        "t1.micro",
        "t2.nano",
        "t2.micro",
        "t2.small",
        "t2.medium",
        "t2.large",
        "m1.small",
        "m1.medium",
        "m1.large",
        "m1.xlarge",
        "m2.xlarge",
        "m2.2xlarge",
        "m2.4xlarge",
        "m3.medium",
        "m3.large",
        "m3.xlarge",
        "m3.2xlarge",
        "m4.large",
        "m4.xlarge",
        "m4.2xlarge",
        "m4.4xlarge",
        "m4.10xlarge",
        "c1.medium",
        "c1.xlarge",
        "c3.large",
        "c3.xlarge",
        "c3.2xlarge",
        "c3.4xlarge",
        "c3.8xlarge",
        "c4.large",
        "c4.xlarge",
        "c4.2xlarge",
        "c4.4xlarge",
        "c4.8xlarge",
        "g2.2xlarge",
        "g2.8xlarge",
        "r3.large",
        "r3.xlarge",
        "r3.2xlarge",
        "r3.4xlarge",
        "r3.8xlarge",
        "i2.xlarge",
        "i2.2xlarge",
        "i2.4xlarge",
        "i2.8xlarge",
        "d2.xlarge",
        "d2.2xlarge",
        "d2.4xlarge",
        "d2.8xlarge",
        "hi1.4xlarge",
        "hs1.8xlarge",
        "cr1.8xlarge",
        "cc2.8xlarge",
        "cg1.4xlarge"
      ],
      "ConstraintDescription": "must be a valid EC2 instance type."
    },
    "KeyPairName": {
      "Description": "Name of an existing EC2 KeyPair:",
      "Type": "AWS::EC2::KeyPair::KeyName"
    },
    "AllowedAddressesToWebServer": {
      "Description": "The IP address range that can be used to connect to the HTTP ELB",
      "Type": "String",
      "MinLength": "9",
      "MaxLength": "18",
      "Default": "0.0.0.0/0",
      "AllowedPattern": "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})",
      "ConstraintDescription": "must be a valid IP CIDR range of the form x.x.x.x/x."
    },
    "AllowedAddressesToBastionHost": {
      "Description": "The IP address range that can be used to connect to the Linux Bastion host",
      "Type": "String",
      "MinLength": "9",
      "MaxLength": "18",
      "Default": "0.0.0.0/0",
      "AllowedPattern": "(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/(\\d{1,2})",
      "ConstraintDescription": "Must be a valid IP CIDR range of the form x.x.x.x/x."
    }
  },
  "Resources": {
    "BaseVPC": {
      "Type": "AWS::EC2::VPC",
      "Properties": {
        "CidrBlock": "10.0.0.0/16",
        "EnableDnsSupport": "true",
        "EnableDnsHostnames": "true",
        "InstanceTenancy": "default",
        "Tags": [
          {
            "Key": "Createdby",
            "Value": "Mehdi"
          },
          {
            "Key": "Name",
            "Value": "BaseVPC"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "f6ffaafc-16fb-4adf-882b-9f88015f51b7"
        }
      }
    },
    "BaseIGW": {
      "Type": "AWS::EC2::InternetGateway",
      "Properties": {
        "Tags": [
          {
            "Key": "Createdby",
            "Value": "Mehdi"
          },
          {
            "Key": "Name",
            "Value": "BaseIGW"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "62296718-6807-467b-99a9-38200ddb8319"
        }
      }
    },
    "AttachIGW": {
      "Type": "AWS::EC2::VPCGatewayAttachment",
      "Properties": {
        "InternetGatewayId": {
          "Ref": "BaseIGW"
        },
        "VpcId": {
          "Ref": "BaseVPC"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "804b9ca0-a56e-41b0-b501-c0a53d2f525f"
        }
      }
    },
    "PublicSubnetA": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "AvailabilityZone": {
          "Fn::Select": [
            "0",
            {
              "Fn::GetAZs": ""
            }
          ]
        },
        "VpcId": {
          "Ref": "BaseVPC"
        },
        "CidrBlock": "10.0.1.0/24",
        "Tags": [
          {
            "Key": "Createdby",
            "Value": "Mehdi"
          },
          {
            "Key": "Name",
            "Value": "PublicSubnetA"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "f9abaa80-8d82-4ba3-8907-955e296bc4eb"
        }
      }
    },
    "PublicSubnetB": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "AvailabilityZone": {
          "Fn::Select": [
            "1",
            {
              "Fn::GetAZs": ""
            }
          ]
        },
        "VpcId": {
          "Ref": "BaseVPC"
        },
        "CidrBlock": "10.0.2.0/24",
        "Tags": [
          {
            "Key": "Createdby",
            "Value": "Mehdi"
          },
          {
            "Key": "Name",
            "Value": "PublicSubnetB"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "dbe5c584-7b5f-485c-a10b-9d55bcab415f"
        }
      }
    },
    "PublicRouteTable": {
      "Type": "AWS::EC2::RouteTable",
      "Properties": {
        "VpcId": {
          "Ref": "BaseVPC"
        },
        "Tags": [
          {
            "Key": "Createdby",
            "Value": "Mehdi"
          },
          {
            "Key": "Name",
            "Value": "PublicRouteTable"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "3674c3c0-b5c9-49ba-b8e5-5103fcddb78d"
        }
      }
    },
    "EC2SRTA42PKP": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "RouteTableId": {
          "Ref": "PublicRouteTable"
        },
        "SubnetId": {
          "Ref": "PublicSubnetB"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "9928691f-7c5b-4f40-b8a4-751713dc6bfa"
        }
      }
    },
    "EC2SRTA1JBZP": {
      "Type": "AWS::EC2::SubnetRouteTableAssociation",
      "Properties": {
        "RouteTableId": {
          "Ref": "PublicRouteTable"
        },
        "SubnetId": {
          "Ref": "PublicSubnetA"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "d9b9492d-a33f-4566-a22d-569a35fe58c0"
        }
      }
    },
    "InternetRoute": {
      "Type": "AWS::EC2::Route",
      "Properties": {
        "DestinationCidrBlock": "0.0.0.0/0",
        "GatewayId": {
          "Ref": "BaseIGW"
        },
        "RouteTableId": {
          "Ref": "PublicRouteTable"
        }
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "2f10149c-07c0-41b2-ae93-7d49b164e827"
        }
      },
      "DependsOn": [
        "AttachIGW"
      ]
    },
    "PrivateSubnetA": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "AvailabilityZone": {
          "Fn::Select": [
            "0",
            {
              "Fn::GetAZs": ""
            }
          ]
        },
        "VpcId": {
          "Ref": "BaseVPC"
        },
        "CidrBlock": "10.0.30.0/24",
        "Tags": [
          {
            "Key": "Createdby",
            "Value": "Mehdi"
          },
          {
            "Key": "Name",
            "Value": "privateSubnetA"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "b6a4b96a-b79b-4e57-8b5b-f0ae752d83c0"
        }
      }
    },
    "PrivateSubnetB": {
      "Type": "AWS::EC2::Subnet",
      "Properties": {
        "AvailabilityZone": {
          "Fn::Select": [
            "1",
            {
              "Fn::GetAZs": ""
            }
          ]
        },
        "VpcId": {
          "Ref": "BaseVPC"
        },
        "CidrBlock": "10.0.4.0/24",
        "Tags": [
          {
            "Key": "Createdby",
            "Value": "Mehdi"
          },
          {
            "Key": "Name",
            "Value": "PrivateSubnetB"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "acd2d8c4-cac7-4595-a154-2ebccf543383"
        }
      }
    },
    "LinuxBastionSecurityGroup": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Allows SSH and WEB",
        "VpcId": {
          "Ref": "BaseVPC"
        },
        "SecurityGroupIngress": [
          {
            "IpProtocol": "tcp",
            "FromPort": "80",
            "ToPort": "80",
            "CidrIp": {
              "Ref": "AllowedAddressesToBastionHost"
            }
          },
          {
            "IpProtocol": "tcp",
            "FromPort": "443",
            "ToPort": "443",
            "CidrIp": {
              "Ref": "AllowedAddressesToBastionHost"
            }
          },
          {
            "IpProtocol": "tcp",
            "FromPort": "22",
            "ToPort": "22",
            "CidrIp": {
              "Ref": "AllowedAddressesToBastionHost"
            }
          }
        ],
        "Tags": [
          {
            "Key": "Createdby",
            "Value": "Mehdi"
          },
          {
            "Key": "Name",
            "Value": "LinuxBastionSecurityGroup"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "745fc5cd-8b2f-4df0-9cf6-e3c2d882170b"
        }
      }
    },
    "LinuxBastionASG": {
      "Type": "AWS::AutoScaling::AutoScalingGroup",
      "Properties": {
        "LaunchConfigurationName": {
          "Ref": "LinuxBastionLaunchConfig"
        },
        "VPCZoneIdentifier": [
          {
            "Ref": "PublicSubnetA"
          },
          {
            "Ref": "PublicSubnetB"
          }
        ],
        "MaxSize": "1",
        "DesiredCapacity": "1",
        "MinSize": "1",
        "HealthCheckGracePeriod": "120",
        "HealthCheckType": "EC2",
        "Tags": [
          {
            "Key": "Createdby",
            "Value": "Mehdi",
            "PropagateAtLaunch": "true"
          },
          {
            "Key": "Name",
            "Value": "Linux Bastion Host",
            "PropagateAtLaunch": "true"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "f9c94ba6-2b9f-44d7-aa68-58381f194463"
        }
      }
    },
    "LinuxBastionLaunchConfig": {
      "Type": "AWS::AutoScaling::LaunchConfiguration",
      "Properties": {
        "InstanceType": {
          "Ref": "InstanceType"
        },
        "AssociatePublicIpAddress": "true",
        "KeyName": {
          "Ref": "KeyPairName"
        },
        "ImageId": {
          "Fn::FindInMap": [
            "AWSRegionArch2AMI",
            {
              "Ref": "AWS::Region"
            },
            {
              "Fn::FindInMap": [
                "AWSInstanceType2Arch",
                {
                  "Ref": "InstanceType"
                },
                "Arch"
              ]
            }
          ]
        },
        "UserData": {
          "Fn::Base64": {
            "Fn::Join": [
              "",
              [
                "#!/bin/bash -xe\n",
                "yum install wget -y\n",
                "/opt/aws/bin/cfn-signal -e 0 --stack ",
                {
                  "Ref": "AWS::StackName"
                },
                " --resource LinuxBastionASG ",
                " --region ",
                {
                  "Ref": "AWS::Region"
                },
                "\n"
              ]
            ]
          }
        },
        "SecurityGroups": [
          {
            "Ref": "LinuxBastionSecurityGroup"
          }
        ]
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "31e67e42-15ec-40fb-8ed8-9b3904d3ed07"
        }
      }
    },
    "LinuxBastionHostEIP": {
      "Type": "AWS::EC2::EIP",
      "Properties": {
        "Domain": "vpc"
      },
      "Metadata": {
        "AWS::CloudFormation::Designer": {
          "id": "7d62cb4e-97fd-4b89-a00a-8920c926c67c"
        }
      }
    }
  },
  "Outputs": {
    "PublicSubnetA": {
      "Value": {
        "Ref": "PublicSubnetA"
      },
      "Description": "Public Subnet A"
    },
    "PublicSubnetB": {
      "Value": {
        "Ref": "PublicSubnetB"
      },
      "Description": "Public Subnet B"
    },
    "PrivateSubnetA": {
      "Value": {
        "Ref": "PrivateSubnetA"
      },
      "Description": "Private Subnet A"
    },
    "PrivateSubnetB": {
      "Value": {
        "Ref": "PrivateSubnetB"
      },
      "Description": "Private Subnet B"
    },
    "KeyPairName": {
      "Value": {
        "Ref": "KeyPairName"
      },
      "Description": "Key pair name."
    }
  }
}
